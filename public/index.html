<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord XP Leaderboard - Cloudflare Moon Theme</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0a0f1f',
                        'accent-cyan': '#22d3ee',
                        'accent-purple': '#a78bfa',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-image: linear-gradient(to bottom right, var(--tw-colors-dark-bg), #1a0f3f);
        }
    </style>
</head>

<body class="min-h-screen text-gray-100 p-6 sm:p-8 font-sans">

    <div class="max-w-3xl mx-auto">
        <div id="leaderboard-container" class="bg-gray-900/90 backdrop-blur-md rounded-[2rem] p-6 sm:p-10 shadow-2xl shadow-accent-cyan/30 border border-accent-cyan/50">
            
            <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-2" 
                style="background-image: linear-gradient(to right, #22d3ee, #a78bfa); -webkit-background-clip: text; color: transparent;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7 inline-block mr-2 mb-1"><path fill-rule="evenodd" d="M9.52 2.378a.75.75 0 0 1 .58.855l.087.696A12.733 12.733 0 0 0 12 19.143c2.56 0 5.01-.502 7.293-1.458a.75.75 0 0 1 .85.58 10.557 10.557 0 0 1-2.95 5.567.75.75 0 0 1-1.41-.318 9.05 9.05 0 0 0 2.275-4.45 14.25 14.25 0 0 1-1.89-3.79c-.9-.672-1.636-1.458-2.186-2.392A13.06 13.06 0 0 0 12 5.25a13.06 13.06 0 0 0-1.87 2.052c-.55.934-1.286 1.72-2.185 2.392a14.25 14.25 0 0 1-1.89 3.79 9.05 9.05 0 0 0 2.275 4.45.75.75 0 0 1-1.41.318A10.557 10.557 0 0 1 3.238 9.548a.75.75 0 0 1 .85-.58 12.733 12.733 0 0 0 7.293 1.458 9.07 9.07 0 0 0-2.275-4.45A.75.75 0 0 1 9.52 2.378Z" clip-rule="evenodd" /></svg>
                Moonlit XP Leaderboard
            </h1>
            <p class="text-center text-sm text-gray-400 mb-8">Live Data from Discord Bot</p>

            <div id="status" class="text-center text-lg text-indigo-400 mb-6">
                Loading Leaderboard...
            </div>

            <div id="leaderboard-list" class="space-y-3">
                </div>

            <p id="last-updated" class="text-center text-xs text-gray-600 mt-6"></p>
        </div>
    </div>

    <script>
        const API_PATH = '/api/leaderboard'; // <-- Panggil Pages Function
        const listContainer = document.getElementById('leaderboard-list');
        const statusElement = document.getElementById('status');
        const updatedElement = document.getElementById('last-updated');

        const trophyIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 shrink-0 mr-4"> <path fill-rule="evenodd" d="M5.132 2.302a.75.75 0 0 1 .64 0l.915.462a4.99 4.99 0 0 0 2.22 1.002h4.286c.86 0 1.674-.35 2.22-1.002l.916-.462a.75.75 0 0 1 .638 0l.915.462a4.99 4.99 0 0 0 2.22 1.002h4.286c.86 0 1.674-.35 2.22-1.002l.916-.462a.75.75 0 0 1 .64 0L22 4.416v16.11a.75.75 0 0 1-.663.743L12 21.75l-9.337-.48a.75.75 0 0 1-.663-.743V4.416l.915-.462Z" clip-rule="evenodd" /> <path d="M12 4.5a.75.75 0 0 1 .75.75v12.586a.75.75 0 0 1-1.5 0V5.25A.75.75 0 0 1 12 4.5Z" /> </svg>`;

        function createRow(player) {
            const isTop1 = player.rank === 1;
            const rankColorClass = isTop1 ? 'text-yellow-300' : 
                                   player.rank === 2 ? 'text-gray-400' : 
                                   player.rank === 3 ? 'text-orange-300' : 'text-indigo-300';
            
            const rowClass = isTop1 ? 
                'bg-indigo-900/50 border border-yellow-500/50 shadow-lg shadow-yellow-500/20' : 
                'bg-gray-800/50 hover:bg-gray-700/50 border border-gray-700/50';

            const rankContent = player.rank <= 3 ? 
                `<span class="${rankColorClass} mr-4">${trophyIcon}</span>` : 
                `<span class="w-6 h-6 text-center font-bold text-lg ${rankColorClass} shrink-0 mr-4">${player.rank}.</span>`;

            return `
                <div class="flex justify-between items-center p-4 rounded-xl transition-all duration-300 ${rowClass}">
                    <div class="flex items-center w-1/2">
                        ${rankContent}
                        <span class="text-lg font-medium truncate ${isTop1 ? 'text-yellow-300' : 'text-gray-100'}">
                            ${player.username}
                        </span>
                    </div>
                    <div class="text-right shrink-0">
                        <span class="text-xl font-mono text-accent-cyan">
                            ${player.xp.toLocaleString()} <span class="text-sm text-cyan-500">XP</span>
                        </span>
                    </div>
                </div>
            `;
        }

        async function fetchLeaderboard() {
            statusElement.innerHTML = 'Loading Leaderboard from Orbit...';

            try {
                // Panggil Pages Function di path lokal
                const response = await fetch(API_PATH); 
                const data = await response.json();

                if (data.success) {
                    listContainer.innerHTML = data.leaderboard.map(createRow).join('');
                    statusElement.innerHTML = 'Data successfully loaded.';
                } else {
                    listContainer.innerHTML = '';
                    statusElement.innerHTML = `⚠️ Error fetching data: ${data.message}`;
                    console.error("API Error:", data.message);
                }
            } catch (error) {
                listContainer.innerHTML = '';
                statusElement.innerHTML = '❌ Connection Error. Check Pages Function setup.';
                console.error("Fetch Error:", error);
            } finally {
                updatedElement.textContent = `Data last updated: ${new Date().toLocaleTimeString()}`;
            }
        }

        window.onload = function() {
            fetchLeaderboard();
            // Refresh data setiap 5 menit
            setInterval(fetchLeaderboard, 300000); 
        };
    </script>
</body>
</html>
